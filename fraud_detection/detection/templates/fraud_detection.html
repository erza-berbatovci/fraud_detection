{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center">Fraud Detection</h1>
    <p class="text-center">Upload your dataset for anomaly detection and analysis.</p>

    <!-- Upload Form -->
    <form method="post" enctype="multipart/form-data" class="mb-4">
        {% csrf_token %}
        <div class="form-group">
            <label for="file">Upload Dataset (CSV):</label>
            <input type="file" name="file" class="form-control-file" required>
        </div>
        <button type="submit" class="btn btn-success">Analyze</button>
    </form>

    <!-- Display Analysis Results -->
    {% if dataset_analysis %}
    <h2>Dataset Analysis</h2>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>Data Shape</td><td>{{ dataset_analysis.data_shape }}</td></tr>
            <tr><td>Null Values</td><td>{{ dataset_analysis.null_values }}</td></tr>
            <tr><td>Percentage of Non-Fraudulent Transactions</td><td>{{ dataset_analysis.percentage_non_fraudulent }}</td></tr>
            <tr><td>Percentage of Fraudulent Transactions</td><td>{{ dataset_analysis.percentage_fraudulent }}</td></tr>
            <tr><td>Total Fraudulent Transactions</td><td>{{ dataset_analysis.total_fraud_transactions }}</td></tr>
            <tr><td>Total Normal Transactions</td><td>{{ dataset_analysis.total_normal_transactions }}</td></tr>
        </tbody>
    </table>
    <a href="{% url 'export_anomalies_excel' dataset_id=dataset_id %}" class="btn btn-primary mt-3">
        Download Anomalies as Excel
    </a>
    {% endif %}

    <!-- Scatter Plot and Pie Chart -->
    {% if scatter_url %}
    <div>
        <h2>Scatter Plot and Pie Chart</h2>
        <img src="data:image/png;base64,{{ scatter_url }}" alt="Scatter Plot and Pie Chart" class="img-fluid">
    </div>
    {% endif %}

    <!-- Heatmap -->
    {% if heatmap_url %}
    <div>
        <h2>Correlation Heatmap</h2>
        <img src="data:image/png;base64,{{ heatmap_url }}" alt="Correlation Heatmap" class="img-fluid">
    </div>
    {% endif %}
</div>
{% endblock %}
